# CCSDS语法单元研究笔记

## 1. 研究背景

在APDL（APDS协议定义语言）项目中，我们需要深入理解CCSDS协议的语法单元，以确保项目需求的合理性和技术实现的可行性。通过研究CCSDS协议标准文档和相关资料，我们对协议结构和语法单元有了更深入的认识。

## 2. CCSDS协议核心概念

### 2.1 协议层次结构
CCSDS协议采用分层架构，主要包含：
- 物理层：信号传输
- 数据链路层：TM/TC协议
- 网络层：AOS协议
- 传输层：CFDP协议
- 应用层：任务特定协议

### 2.2 语法单元定义
语法单元是协议的基本构成元素，每个单元负责特定的协议功能，具有明确的输入输出接口。

## 3. 核心语法单元分析

### 3.1 TM Transfer Frame (CCSDS 132.0-B-3)
- **功能**：遥测数据传输
- **结构**：主头部 + 数据字段 + 错误控制
- **关键字段**：
  - 转换帧ID（16位）
  - 源包ID（16位）
  - 序列标志（2位）
  - 数据字段长度（16位）

### 3.2 TC Transfer Frame (CCSDS 232.0-B-3)
- **功能**：遥控命令传输
- **结构**：主头部 + 数据字段 + FARM
- **关键字段**：
  - 版本号（2位）
  - 类型（1位）
  - 航天器ID（10位）
  - 虚拟通道ID（3位）

### 3.3 Space Packet (CCSDS 133.0-B-3)
- **功能**：应用数据封装
- **结构**：主头部 + 数据字段
- **关键字段**：
  - 版本号（3位）
  - 包类型（1位）
  - APID（11位）
  - 序列标志（2位）

## 4. 语法单元设计原则

### 4.1 模块化设计
- 每个语法单元独立实现
- 明确的输入输出接口
- 便于测试和维护

### 4.2 标准化接口
- 统一的ProtocolUnit接口
- 支持打包/拆包/校验操作
- 保证单元间的互操作性

### 4.3 可扩展性
- 支持自定义语法单元
- 保留扩展字段和接口
- 兼容现有标准

## 5. 项目实现要点

### 5.1 Rust实现策略
- 利用Trait系统实现多态
- 使用所有权系统保证内存安全
- 通过模块化组织代码结构

### 5.2 DSL设计考虑
- 简洁易读的语法
- 支持层次化定义
- 允许参数化配置

### 5.3 组合策略
- 垂直组合：上下层协议封装
- 水平组合：同层协议复用
- 混合组合：复杂协议栈

## 6. 需求合理性验证

通过对CCSDS协议语法单元的深入研究，我们验证了项目需求的合理性：

1. **技术可行性**：协议结构清晰，适合模块化实现
2. **功能完整性**：覆盖航天通信主要协议层
3. **扩展性保障**：支持标准与自定义协议混合使用
4. **实用性**：满足实际航天任务需求

## 7. 下一步计划

1. 完善各语法单元的具体实现
2. 设计单元间组合的机制
3. 开发DSL解析器
4. 实现仿真验证功能
5. 构建测试用例库

## 8. 关键决策记录

### 8.1 接口设计
决定使用Rust Trait作为语法单元的统一接口，保证类型安全和性能。

### 8.2 组合方式
采用协议栈方式管理语法单元组合，支持动态组装。

### 8.3 扩展机制
通过工厂模式支持自定义语法单元的注册和管理。

这些研究结果为项目的后续开发奠定了坚实的理论基础，确保了项目方向的正确性。